!function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}},d=[].slice;a=function(){function a(a,b,d,e,f){this.cli_path=a,this.onmessage=d,this.onopen=e,this.onclose=f,this.on_message=c(this.on_message,this),this.on_close=c(this.on_close,this),this.on_open=c(this.on_open,this),this.send=c(this.send,this),this.reconnect_try=c(this.reconnect_try,this),this.reconnect_reset=c(this.reconnect_reset,this),this.connect=c(this.connect,this),this.update_status=c(this.update_status,this),this.on=c(this.on,this),$.extend(this.reconnect,b)}return a.prototype.reconnect={reconnecting:!1,do_not_reconnect:!1,reload_after_n:!0,max_retries:30,reset_mult:6,retry_timeout_ms:1500+Math.floor(60*Math.random()),retry_multiplier:2,retry_curr_multiplier:0,retry_curr_timeout:0,retry_count:0},a.prototype.conn=null,a.prototype.eventHandlers={reconnect:[],connect:[],open:[],close:[],message:[]},a.prototype.on=function(a,b){var c,d,e,f;for(c=a.trim().split(/\s+/),e=0,f=c.length;f>e;e++)a=c[e],d=this.eventHandlers[a],d.push(b);return this},a.prototype.update_status=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;if(this.reconnect.reconnecting){for(h=this.eventHandlers.reconnect,k=[],b=0,e=h.length;e>b;b++)a=h[b],k.push(a());return k}if(null===this.conn||this.conn.readyState!==SockJS.OPEN){for(i=this.eventHandlers.close,l=[],c=0,f=i.length;f>c;c++)a=i[c],l.push(a());return l}for(j=this.eventHandlers.open,m=[],d=0,g=j.length;g>d;d++)a=j[d],m.push(a());return m},a.prototype.connect=function(){var a,b,c,d;for(null!=this.conn&&(this.conn.close(),this.conn=null),this.conn=new SockJS(this.cli_path),d=this.eventHandlers.connect,b=0,c=d.length;c>b;b++)a=d[b],a();return this.conn.onopen=this.on_open,this.conn.onclose=this.on_close,this.conn.onmessage=this.on_message},a.prototype.reconnect_reset=function(){return this.reconnect.reconnecting=!1,this.reconnect.retry_curr_timeout=0,this.reconnect.retry_curr_multipler=0,this.reconnect.retry_count=0},a.prototype.reconnect_try=function(a){var b,c=this;return this.reconnect.retry_count===this.reconnect.max_retries?(this.reconnect.reconnecting=!1,this.reconnect.reload_after_n&&window.location.reload(!0),void 0):this.reconnect.reconnecting?(this.reconnect.retry_count+=1,b=function(){return c.reconnect.retry_curr_timeout*=c.reconnect.retry_multiplier,c.reconnect.retry_curr_multipler+=1,c.reconnect.retry_curr_multipler===c.reconnect.reset_mult&&(c.reconnect.retry_curr_timeout=c.reconnect.retry_timeout_ms,c.reconnect.retry_curr_multipler=1),a()},setTimeout(b,this.reconnect.retry_curr_timeout)):(this.reconnect.reconnecting=!0,this.reconnect.retry_curr_timeout=this.reconnect.retry_timeout_ms,this.reconnect.retry_curr_multipler=1,this.reconnect.retry_count=1,a())},a.prototype.send=function(a){return this.conn.send(a)},a.prototype.on_open=function(){return this.reconnect_reset(),this.update_status(),"function"==typeof this.onopen?this.onopen():void 0},a.prototype.on_close=function(){return this.conn=null,this.update_status(),"function"==typeof this.onclose&&this.onclose(),this.reconnect.do_not_reconnect?void 0:this.reconnect_try(this.connect)},a.prototype.on_message=function(){var a,b,c,e,f,g,h;for(a=1<=arguments.length?d.call(arguments,0):[],null!=(f=this.onmessage)&&f.apply(a),g=this.eventHandlers.message,h=[],c=0,e=g.length;e>c;c++)b=g[c],h.push(b.apply(this.conn,a));return h},a}(),b="undefined"!=typeof exports&&null!==exports?exports:this,b.SockReconnect=a}.call(this);