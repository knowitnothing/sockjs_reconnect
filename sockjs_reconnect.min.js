(function(){var e,t,n,r=function(e,t){return function(){return e.apply(t,arguments)}};n=function(e,t){var n,r;for(n in t){r=t[n];e[n]=r}return e};e=function(t){e=function(){function e(e,t,i,s,o,u){this.cli_path=e;this.status_cb=i;this.cli_onmessage=s;this.cli_onopen=o;this.cli_onclose=u;this.on_close=r(this.on_close,this);this.on_open=r(this.on_open,this);this.send=r(this.send,this);this.reconnect_try=r(this.reconnect_try,this);this.reconnect_reset=r(this.reconnect_reset,this);this.connect=r(this.connect,this);this.update_status=r(this.update_status,this);n(this.reconnect,t)}e.prototype.reconnect={reconnecting:false,do_not_reconnect:false,reload_after_n:true,max_retries:30,reset_mult:6,retry_timeout_ms:1500+Math.floor(Math.random()*60),retry_multiplier:2,retry_curr_multiplier:0,retry_curr_timeout:0,retry_count:0};e.prototype.conn=null;e.prototype.update_status=function(){if(this.reconnect.reconnecting){if(this.status_cb!=null){return this.status_cb("reconnecting")}}else if(this.conn===null||this.conn.readyState!==t.OPEN){if(this.status_cb!=null){return this.status_cb("disconnected")}}else{if(this.status_cb!=null){return this.status_cb("connected")}}};e.prototype.connect=function(){if(this.conn!=null){this.conn.close();this.conn=null}this.conn=new t(this.cli_path);if(this.status_cb!=null){this.status_cb("connecting")}this.conn.onopen=this.on_open;this.conn.onclose=this.on_close;return this.conn.onmessage=this.cli_onmessage};e.prototype.reconnect_reset=function(){this.reconnect.reconnecting=false;this.reconnect.retry_curr_timeout=0;this.reconnect.retry_curr_multipler=0;return this.reconnect.retry_count=0};e.prototype.reconnect_try=function(e){var t;if(this.reconnect.retry_count===this.reconnect.max_retries){this.reconnect.reconnecting=false;if(this.reconnect.reload_after_n){window.location.reload(true)}return}if(!this.reconnect.reconnecting){this.reconnect.reconnecting=true;this.reconnect.retry_curr_timeout=this.reconnect.retry_timeout_ms;this.reconnect.retry_curr_multipler=1;this.reconnect.retry_count=1;return e()}else{this.reconnect.retry_count+=1;t=function(t){return function(){t.reconnect.retry_curr_timeout*=t.reconnect.retry_multiplier;t.reconnect.retry_curr_multipler+=1;if(t.reconnect.retry_curr_multipler===t.reconnect.reset_mult){t.reconnect.retry_curr_timeout=t.reconnect.retry_timeout_ms;t.reconnect.retry_curr_multipler=1}return e()}}(this);return setTimeout(t,this.reconnect.retry_curr_timeout)}};e.prototype.send=function(e){return this.conn.send(e)};e.prototype.on_open=function(){this.reconnect_reset();this.update_status();if(this.cli_onopen!=null){return this.cli_onopen()}};e.prototype.on_close=function(){this.conn=null;this.update_status();if(this.cli_onclose!=null){this.cli_onclose()}if(this.reconnect.do_not_reconnect){return}return this.reconnect_try(this.connect)};return e}();return e};if(typeof define==="function"&&define.amd){define(["sockjs"],function(t){return e(t)})}else{t=typeof exports!=="undefined"&&exports!==null?exports:this;t.SockReconnect=e()}}).call(this)